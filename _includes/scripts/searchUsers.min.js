async function searchUsers(query){try{console.log(`Searching for users: "${query}"`);const response=await fetch(`http://media.maar.world:3001/api/searchUsers?query=${encodeURIComponent(query)}`);if(!response.ok)return console.warn(`Search request failed with status: ${response.status}`),[];const data=await response.json();return console.log(`Found ${data.length} users for query: "${query}"`),data}catch(error){return console.error("Error during user search:",error),[]}}async function checkUsernameValidity(username){try{console.log(`Validating username: "${username}"`);const response=await fetch(`http://media.maar.world:3001/api/checkUsername?username=${encodeURIComponent(username)}`);return!1===(await response.json()).isUnique}catch(error){return console.error("Error checking username validity:",error),!1}}function updateResultsDropdown(users,container,inputElement){if(container.innerHTML="",0===users.length){console.log("No users found.");const noResult=document.createElement("div");noResult.className="user-result",noResult.textContent="No users found. Invite them to join for better collaboration!",noResult.style.color="#d9534f",container.appendChild(noResult);const inviteButton=document.createElement("button");return inviteButton.className="invite-button",inviteButton.textContent="Register a new xPlorer",inviteButton.addEventListener("click",(()=>{window.location.href="/register"})),void container.appendChild(inviteButton)}console.log(`Updating dropdown with ${users.length} users.`),users.forEach((user=>{const item=document.createElement("div");if(item.className="user-result",user.profilePicture){const img=document.createElement("img");img.src=user.profilePicture,img.alt=`${user.displayName}'s profile picture`,img.width=30,img.height=30,img.style.marginRight="10px",item.appendChild(img)}const text=document.createElement("span");text.textContent=`${user.displayName} (@${user.username})`,item.appendChild(text),item.addEventListener("click",(()=>{console.log(`User selected: @${user.username}`),inputElement.value=user.username,container.innerHTML=""})),container.appendChild(item)}))}function handleUserSearch(inputElement,resultsContainer){let timeout;inputElement.addEventListener("input",(()=>{clearTimeout(timeout);const query=inputElement.value.trim();if(0===query.length)return resultsContainer.innerHTML="",void console.log("Input cleared.");timeout=setTimeout((async()=>{updateResultsDropdown(await searchUsers(query),resultsContainer,inputElement)}),300)})),inputElement.addEventListener("blur",(async()=>{const inputValue=inputElement.value.trim();if(inputValue){await checkUsernameValidity(inputValue)||(console.log(`Invalid username entered: ${inputValue}. Clearing input.`),inputElement.value="")}})),document.addEventListener("click",(event=>{resultsContainer.contains(event.target)||event.target===inputElement||(resultsContainer.innerHTML="")}))}document.addEventListener("DOMContentLoaded",(()=>{const searchInput=document.querySelector(".user-search-input"),resultsContainer=searchInput?.nextElementSibling;searchInput&&resultsContainer&&resultsContainer.classList.contains("dropdown")?(console.log("Search input initialized."),handleUserSearch(searchInput,resultsContainer)):console.warn("Search input or results container not found.")})),document.addEventListener("DOMContentLoaded",(()=>{document.querySelectorAll(".user-search-input").forEach((input=>{const resultsContainer=input.nextElementSibling;resultsContainer&&resultsContainer.classList.contains("dropdown")&&handleUserSearch(input,resultsContainer)}))}));